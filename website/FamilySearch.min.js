var FamilySearch=function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){function n(e){return function(t,o,n){"function"==typeof o&&(n=o,o={}),o.method=e,this.request(t,o,n)}}function r(e,t){return{statusCode:e.status,statusText:e.statusText,getHeader:function(t){return e.getResponseHeader(t)},getAllHeaders:function(){return e.getAllResponseHeaders()},originalUrl:t.url,effectiveUrl:t.url,redirected:!1,requestMethod:t.method,requestHeaders:t.headers,body:e.responseText,retries:0,throttled:!1}}function s(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}function i(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}var a=o(1),c=function(e){if(this.appKey=e.appKey,this.environment=e.environment||"integration",this.redirectUri=e.redirectUri,this.saveAccessToken=e.saveAccessToken||!0,this.tokenCookie=e.tokenCookie||"FS_AUTH_TOKEN",this.maxThrottledRetries=e.maxThrottledRetries||10,this.saveAccessToken)if(e.accessToken)this.setAccessToken(e.accessToken);else{var t=a.getItem(this.tokenCookie);t&&(this.accessToken=t)}};c.prototype.oauthRedirect=function(){window.location.href=this.identHost()+"/cis-web/oauth2/v3/authorization?response_type=code&client_id="+this.appKey+"&redirect_uri="+this.redirectUri},c.prototype.oauthResponse=function(e){var t=this,o=i("code");return!!o&&(this.post(this.identHost()+"/cis-web/oauth2/v3/token",{body:{grant_type:"authorization_code",code:o,client_id:this.appKey},headers:{"Content-Type":"application/x-www-form-urlencoded"}},function(o){t.processOauthResponse(o,e)}),!0)},c.prototype.oauthPassword=function(e,t,o){var n=this;this.post(this.identHost()+"/cis-web/oauth2/v3/token",{body:{grant_type:"password",client_id:this.appKey,username:e,password:t},headers:{"Content-Type":"application/x-www-form-urlencoded"}},function(e){n.processOauthResponse(e,o)})},c.prototype.processOauthResponse=function(e,t){e&&200===e.statusCode&&e.data&&this.setAccessToken(e.data.access_token),t&&setTimeout(function(){t(e)})},c.prototype.setAccessToken=function(e){this.accessToken=e,this.saveAccessToken&&a.setItem(this.tokenCookie,e,86400)},c.prototype.getAccessToken=function(){return this.accessToken},c.prototype.deleteAccessToken=function(){this.accessToken=void 0,this.saveAccessToken&&a.removeItem(this.tokenCookie)},c.prototype.get=n("GET"),c.prototype.post=n("POST"),c.prototype.head=n("HEAD"),c.prototype.delete=n("DELETE"),c.prototype.request=function(e,t,o){var n,r=this;"function"==typeof options&&(o=t,t={}),o||(o=function(){}),n=this._prepareRequestOptions(e,t);var s=new XMLHttpRequest;s.open(n.method,n.url);for(var i in n.headers)n.headers.hasOwnProperty(i)&&s.setRequestHeader(i,n.headers[i]);s.onload=function(){r._processResponse(s,n,o)},s.onerror=function(e){o()},s.send(n.body)},c.prototype._prepareRequestOptions=function(e,t){var o,n="GET",r={},i=0;t.retries&&(i=t.retries),t.method&&(n=t.method),t.headers&&(r=JSON.parse(JSON.stringify(t.headers))),o=t.body,e.indexOf("https://")===-1&&(e=this.platformHost()+e);var a=e.indexOf("/platform/")!==-1;return!r.Accept&&a&&(r.Accept="application/x-fs-v1+json"),!r.Authorization&&this.accessToken&&(r.Authorization="Bearer "+this.accessToken),!r["X-Expect-Override"]&&a&&(r["X-Expect-Override"]="200-ok"),!o||"POST"!==n&&"PUT"!==n||(!r["Content-Type"]&&a&&(r["Content-Type"]="application/x-fs-v1+json"),"string"!=typeof o&&(o=r["Content-Type"]&&r["Content-Type"].indexOf("json")!==-1?JSON.stringify(o):s(o))),{url:e,method:n,headers:r,body:o,retries:i}},c.prototype._processResponse=function(e,t,o){var n=this,s=r(e,t),i=s.getHeader("Location");if(200===s.statusCode&&i&&i!==t.url)return void setTimeout(function(){n.request(s.getHeader("Location"),t,function(e){e&&(e.originalUrl=t.url,e.redirected=!0),setTimeout(function(){o(e)})})});if(429===s.statusCode&&t.retries<n.maxThrottledRetries){var a=1e3*parseInt(s.getHeader("Retry"),10)||1e3;return void setTimeout(function(){n.request(t.url,t,function(e){e.throttled=!0,e.retries=++t.retries,setTimeout(function(){o(e)})})},a)}var c=s.getHeader("Content-Type");if(c&&c.indexOf("json")!==-1)try{s.data=JSON.parse(s.body)}catch(e){}o(s)},c.prototype.identHost=function(){switch(this.environment){case"production":return"https://ident.familysearch.org";case"beta":return"https://identbeta.familysearch.org";default:return"https://integration.familysearch.org"}},c.prototype.platformHost=function(){switch(this.environment){case"production":return"https://familysearch.org";case"beta":return"https://beta.familysearch.org";default:return"https://integration.familysearch.org"}},e.exports=c},function(e,t,o){!function(t){e.exports=t()}(function(){var e={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,o,n,r,s){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var i="";if(o)switch(o.constructor){case Number:i=o===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+o;break;case String:i="; expires="+o;break;case Date:i="; expires="+o.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+i+(r?"; domain="+r:"")+(n?"; path="+n:"")+(s?"; secure":""),!0},removeItem:function(e,t,o){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(o?"; domain="+o:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,o=0;o<t;o++)e[o]=decodeURIComponent(e[o]);return e}};return e})}]);